//-----------------------------------------------------------------------------------------------
//
// 雪崩発生時の処理[avalanche.cpp]
// Author : Koshimoto Manato
//
//-----------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------
// インクルードファイル
//-----------------------------------------------------------------------------------------------
#include "avalanche.h"
#include "logo.h"
#include "player.h"
#include "manager.h"
#include "renderer.h"
#include "library.h"
#include "game.h"

//-----------------------------------------------------------------------------------------------
// 定数定義
//-----------------------------------------------------------------------------------------------
//雪崩でプレイヤーが押し戻される量
const int CAvalanche::amountPush = 1;

//-----------------------------------------------------------------------------------------------
// コンストラクタ
//-----------------------------------------------------------------------------------------------
CAvalanche::CAvalanche()
{
}

//-----------------------------------------------------------------------------------------------
// デストラクタ
//-----------------------------------------------------------------------------------------------
CAvalanche::~CAvalanche()
{

}

//-----------------------------------------------------------------------------------------------
// 生成
//-----------------------------------------------------------------------------------------------
CAvalanche* CAvalanche::Create()
{
	// ポインタクラスを宣言
	CAvalanche* pAvalanche = new CAvalanche;

	if (pAvalanche != nullptr)
	{// もしnullptrではなかったら
		// 初期化
		pAvalanche->Init();
	}

	return pAvalanche;
}

//-----------------------------------------------------------------------------------------------
// 初期化
//-----------------------------------------------------------------------------------------------
HRESULT CAvalanche::Init()
{
	//ロゴのcreate関数からテクスチャを表示
	//CLogo::Create(テクスチャの名前);
	// 初期化
	CObject2D::Init();

	return S_OK;
}

//-----------------------------------------------------------------------------------------------
// 終了
//-----------------------------------------------------------------------------------------------
void CAvalanche::Uninit()
{
	CObject2D::Uninit();
}

//-----------------------------------------------------------------------------------------------
// 更新
//-----------------------------------------------------------------------------------------------
void CAvalanche::Update()
{
	for (int nCntObject = 0; nCntObject < CObject::MAX_OBJECT; nCntObject++)
	{
		CObject *pObject = CObject::GetObject(nCntObject);
		if (pObject != nullptr)
		{
			CObject::EObject objType = pObject->GetObjType();

			//プレイヤーを押し戻す
			if (objType == OBJ_PLAYER)
			{
				//オブジェクトポインタをプレイヤーにダウンキャスト
				CPlayer *pPlayer = (CPlayer*)pObject;

				pPlayer->PushBack();
				Uninit();
			}
		}
	}
}

//-----------------------------------------------------------------------------------------------
// 描画
//-----------------------------------------------------------------------------------------------
void CAvalanche::Draw()
{
	CObject2D::Draw();
}